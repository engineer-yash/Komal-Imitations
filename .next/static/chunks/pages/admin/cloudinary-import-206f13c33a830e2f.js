(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[840],{8779:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/cloudinary-import",function(){return t(8409)}])},8409:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return m}});var s=t(5893),l=t(7294),d=t(9008),i=t.n(d),r=t(5675),n=t.n(r),c=t(7066),o=t(1163);function m(){let e=(0,o.useRouter)(),[a,t]=(0,l.useState)([]),[d,r]=(0,l.useState)(!1),[m,u]=(0,l.useState)(!1),[p,h]=(0,l.useState)([]),[g,x]=(0,l.useState)([]),[b,y]=(0,l.useState)(""),[f,j]=(0,l.useState)("");(0,l.useEffect)(()=>{localStorage.getItem("adminToken")||e.push("/admin/login")},[e]);let v=async()=>{r(!0),y("");try{let e=await c.Z.get("/api/cloudinary/fetch-images");t(e.data.images),j("Found ".concat(e.data.count," images from Cloudinary"))}catch(t){var e,a;y("Failed to fetch images: "+(null===(a=t.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.error))}finally{r(!1)}},N=e=>{x(a=>a.includes(e)?a.filter(a=>a!==e):[...a,e])},w=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(0===g.length){y("Please select images to analyze");return}u(!0),y(""),j("");try{let t=a.filter(e=>g.includes(e.publicId)),s=await c.Z.post("/api/cloudinary/analyze-and-import",{images:t,autoImport:e});e?(j("Successfully imported ".concat(s.data.analyzed," products!")),x([]),h([])):(h(s.data.results),j("Analyzed ".concat(s.data.analyzed," images. Review and import below."))),s.data.errors.length>0&&y("".concat(s.data.errors.length," images failed to analyze"))}catch(e){var t,s;y("Failed to analyze images: "+(null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.error))}finally{u(!1)}},I=async()=>{r(!0),y("");try{let e=localStorage.getItem("adminToken"),a=p.map(a=>c.Z.post("/api/products",a.productData,{headers:{Authorization:"Bearer ".concat(e)}}));await Promise.all(a),j("Successfully imported ".concat(p.length," products!")),h([]),x([])}catch(e){y("Failed to import products: "+e.message)}finally{r(!1)}};return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)(i(),{children:(0,s.jsx)("title",{children:"Cloudinary Import - Admin"})}),(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold font-playfair","data-testid":"page-title",children:"Import from Cloudinary"}),(0,s.jsx)("button",{onClick:()=>e.push("/admin/dashboard"),className:"px-4 py-2 text-sm bg-gray-200 hover:bg-gray-300 rounded","data-testid":"back-button",children:"← Back to Dashboard"})]}),b&&(0,s.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded mb-4","data-testid":"error-message",children:b}),f&&(0,s.jsx)("div",{className:"bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded mb-4","data-testid":"success-message",children:f}),(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow mb-8",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Step 1: Fetch Images from Cloudinary"}),(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:'Fetch all images from the "komal_imitation_jewellery" folder'}),(0,s.jsx)("button",{onClick:v,disabled:d,className:"bg-primary text-white px-6 py-3 rounded hover:bg-[#B5952F] disabled:opacity-50","data-testid":"fetch-images-button",children:d?"Fetching...":"Fetch Images"})]}),a.length>0&&(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow mb-8",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsxs)("h2",{className:"text-xl font-semibold",children:["Step 2: Select Images (",g.length," selected)"]}),(0,s.jsxs)("div",{className:"space-x-2",children:[(0,s.jsx)("button",{onClick:()=>{x(a.map(e=>e.publicId))},className:"px-4 py-2 text-sm bg-gray-200 hover:bg-gray-300 rounded","data-testid":"select-all-button",children:"Select All"}),(0,s.jsx)("button",{onClick:()=>{x([])},className:"px-4 py-2 text-sm bg-gray-200 hover:bg-gray-300 rounded","data-testid":"deselect-all-button",children:"Deselect All"})]})]}),(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-4","data-testid":"images-grid",children:a.map(e=>(0,s.jsxs)("div",{onClick:()=>N(e.publicId),className:"relative cursor-pointer border-4 transition-all ".concat(g.includes(e.publicId)?"border-primary":"border-transparent hover:border-gray-300"),"data-testid":"image-".concat(e.publicId),children:[(0,s.jsx)("div",{className:"relative h-40",children:(0,s.jsx)(n(),{src:e.url,alt:e.filename,fill:!0,className:"object-cover"})}),g.includes(e.publicId)&&(0,s.jsx)("div",{className:"absolute top-2 right-2 bg-primary text-white rounded-full w-6 h-6 flex items-center justify-center",children:"✓"}),(0,s.jsx)("p",{className:"text-xs text-center p-1 bg-gray-100 truncate",children:e.filename})]},e.publicId))}),(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsx)("button",{onClick:()=>w(!1),disabled:m||0===g.length,className:"bg-blue-600 text-white px-6 py-3 rounded hover:bg-blue-700 disabled:opacity-50","data-testid":"analyze-button",children:m?"Analyzing...":"Analyze Selected Images"}),(0,s.jsx)("button",{onClick:()=>w(!0),disabled:m||0===g.length,className:"bg-green-600 text-white px-6 py-3 rounded hover:bg-green-700 disabled:opacity-50","data-testid":"auto-import-button",children:m?"Processing...":"Analyze & Auto-Import"})]})]}),p.length>0&&(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold",children:"Step 3: Review & Import"}),(0,s.jsx)("button",{onClick:I,disabled:d,className:"bg-primary text-white px-6 py-3 rounded hover:bg-[#B5952F] disabled:opacity-50","data-testid":"import-analyzed-button",children:d?"Importing...":"Import ".concat(p.length," Products")})]}),(0,s.jsx)("div",{className:"space-y-6","data-testid":"analyzed-results",children:p.map((e,a)=>{var t;return(0,s.jsx)("div",{className:"border p-4 rounded-lg",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsx)("div",{className:"relative h-48",children:(0,s.jsx)(n(),{src:e.imageInfo.url,alt:e.productData.name,fill:!0,className:"object-cover rounded"})}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:e.productData.name}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:e.productData.description}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-semibold",children:"Category:"})," ",e.analysis.category]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-semibold",children:"Price:"})," ₹",e.productData.price]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-semibold",children:"Gender:"})," ",e.productData.gender]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-semibold",children:"Size:"})," ",e.productData.size]})]}),(null===(t=e.productData.features)||void 0===t?void 0:t.length)>0&&(0,s.jsxs)("div",{className:"mt-2",children:[(0,s.jsx)("span",{className:"font-semibold text-sm",children:"Features:"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:e.productData.features.map((e,a)=>(0,s.jsx)("span",{className:"bg-gray-100 text-xs px-2 py-1 rounded",children:e},a))})]})]})]})},a)})})]})]})]})}},1163:function(e,a,t){e.exports=t(3079)}},function(e){e.O(0,[703,675,888,774,179],function(){return e(e.s=8779)}),_N_E=e.O()}]);